{% extends 'base.html' %}

{% block title %}CloudShare - {{ file.original_name }}{% endblock %}

{% block content %}
<div class="flex flex-col gap-6">
    
    <nav class="flex items-center text-sm">
        <a href="{% url 'dashboard' %}" class="text-text-muted hover:text-white transition-colors">Dashboard</a>
        <span class="mx-2 text-text-muted">/</span>
        <a href="{% url 'file_list' %}" class="text-text-muted hover:text-white transition-colors">My Files</a>
        <span class="mx-2 text-text-muted">/</span>
        <span class="text-primary font-bold uppercase truncate max-w-[200px]">{{ file.original_name }}</span>
    </nav>

    
    <div class="flex flex-col md:flex-row md:items-start justify-between gap-6 pb-6 border-b border-surface-border">
        <div class="flex gap-4">
            <div
                class="flex-shrink-0 size-16 rounded-xl bg-surface-dark border border-surface-border flex items-center justify-center text-primary shadow-[0_0_15px_rgba(244,37,140,0.15)]">
                <span class="material-symbols-outlined text-[32px]">
                    {% with ext=file.original_name|lower|slice:"-4:" %}
                    {% if ext == ".pdf" %}picture_as_pdf
                    {% elif ext == ".png" or ext == ".jpg" %}image
                    {% elif ext == ".zip" %}folder_zip
                    {% else %}description{% endif %}
                    {% endwith %}
                </span>
            </div>
            <div class="min-w-0">
                <h1 class="text-3xl md:text-4xl font-black text-white tracking-tight mb-2 truncate max-w-xl">{{ file.original_name }}</h1>
                <div class="flex flex-wrap items-center gap-3 text-text-muted text-sm">
                    <span class="bg-surface-dark px-2 py-0.5 rounded text-white border border-surface-border uppercase tracking-widest text-[10px] font-bold">Secure</span>
                    <span>•</span>
                    <span>Uploaded {{ file.uploaded_at|date:"M d, Y" }}</span>
                    <span>•</span>
                    <span class="flex items-center gap-1"><span class="material-symbols-outlined text-[14px]">lock</span> Private</span>
                </div>
            </div>
        </div>
        <div class="flex flex-wrap gap-3">
            {% if file.file %}
            <a href="{{ file.file.url }}" download
                class="flex items-center gap-2 px-6 py-2.5 rounded-lg bg-primary hover:bg-primary-hover text-white shadow-[0_0_20px_rgba(244,37,140,0.3)] transition-all font-bold text-sm group">
                <span class="material-symbols-outlined text-[18px] group-hover:animate-bounce">download</span>
                <span>Download</span>
            </a>
            {% else %}
            <button disabled
                class="flex items-center gap-2 px-6 py-2.5 rounded-lg bg-surface-border text-text-muted font-bold text-sm cursor-not-allowed opacity-50">
                <span class="material-symbols-outlined text-[18px]">block</span>
                <span>Source Missing</span>
            </button>
            {% endif %}
        </div>
    </div>

    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-2 flex flex-col gap-8">
            
            <section class="bg-surface-dark border border-surface-border rounded-xl p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-primary/5 blur-[80px] rounded-full pointer-events-none">
                </div>
                <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2 uppercase tracking-wider">
                    <span class="material-symbols-outlined text-primary">info</span> Protocol Metadata
                </h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div
                        class="p-4 rounded-lg bg-background-dark border border-surface-border hover:border-primary/30 transition-colors">
                        <div class="text-text-muted text-[10px] uppercase tracking-widest mb-1">Data Weight</div>
                        <div class="text-white font-bold text-lg">{{ file.size|filesizeformat }}</div>
                    </div>
                    <div
                        class="p-4 rounded-lg bg-background-dark border border-surface-border hover:border-primary/30 transition-colors">
                        <div class="text-text-muted text-[10px] uppercase tracking-widest mb-1">Extension</div>
                        <div class="text-white font-bold text-lg uppercase">{{ file.original_name|slice:"-3:" }}</div>
                    </div>
                    <div
                        class="p-4 rounded-lg bg-background-dark border border-surface-border hover:border-primary/30 transition-colors">
                        <div class="text-text-muted text-[10px] uppercase tracking-widest mb-1">Owner</div>
                        <div class="text-white font-bold text-lg">{{ file.user.username }}</div>
                    </div>
                    <div
                        class="p-4 rounded-lg bg-background-dark border border-surface-border hover:border-primary/30 transition-colors">
                        <div class="text-text-muted text-[10px] uppercase tracking-widest mb-1">Enc Level</div>
                        <div class="text-primary font-bold text-lg">HIGH</div>
                    </div>
                </div>
            </section>

            
            <section class="bg-surface-dark border border-surface-border rounded-xl overflow-hidden">
                <div class="p-6 border-b border-surface-border flex justify-between items-center bg-background-dark/50">
                    <h3 class="text-lg font-bold text-white flex items-center gap-2 uppercase tracking-wide">
                        <span class="material-symbols-outlined text-primary">link</span>
                        Active Share Uplinks
                    </h3>
                    <span
                        class="text-xs font-bold text-primary bg-primary/10 px-2 py-1 rounded border border-primary/20 uppercase">{{ links|length }} ACTIVE</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr
                                class="bg-background-dark text-text-muted text-[10px] uppercase tracking-[0.2em] font-bold border-b border-surface-border">
                                <th class="p-4">Link ID</th>
                                <th class="p-4">Expires In</th>
                                <th class="p-4 text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm divide-y divide-surface-border">
                            {% for link in links %}
                            <tr class="hover:bg-white/[0.02] transition-colors group">
                                <td class="p-4 text-white font-mono">
                                    <div class="flex items-center gap-2">
                                        <span class="size-2 rounded-full bg-emerald-500 animate-pulse"></span>
                                        {{ link.link_id|stringformat:"s"|slice:":12" }}...
                                    </div>
                                </td>
                                <td class="p-4 text-primary font-bold">{{ link.expires_at|timeuntil }}</td>
                                <td class="p-4 text-right">
                                    <div class="flex items-center justify-end gap-2">
                                        <button
                                            data-url="{{ request.scheme }}://{{ request.get_host }}{% url 'share_page' link.link_id %}"
                                            onclick="navigator.clipboard.writeText(this.dataset.url)"
                                            class="text-text-muted hover:text-white p-2 rounded hover:bg-white/10"
                                            title="Copy Link">
                                            <span class="material-symbols-outlined text-[20px]">content_copy</span>
                                        </button>
                                        <form action="{% url 'delete_secure_link' link.id %}" method="POST"
                                            onsubmit="return confirm('Terminate this uplink immediately?');"
                                            class="inline">
                                            {% csrf_token %}
                                            <button type="submit"
                                                class="text-red-500 hover:text-red-400 p-2 rounded hover:bg-red-500/10"
                                                title="Revoke Link">
                                                <span class="material-symbols-outlined text-[20px]">cancel</span>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="p-12 text-center text-text-muted italic">No active links generated for this vector.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        
        <div class="flex flex-col gap-8">
            
            {% include 'includes/security_status.html' %}
            <div
                class="bg-surface-dark border border-primary/30 rounded-xl p-6 shadow-[0_0_30px_rgba(244,37,140,0.05)] relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary to-purple-600"></div>
                <h3 class="text-lg font-bold text-white mb-2 uppercase tracking-wide">Generate Secure Link</h3>
                <p class="text-text-muted text-sm mb-6">Initialize a new temporary access portal for this data.</p>
                <form action="{% url 'generate_secure_link' file.id %}" method="POST" class="flex flex-col gap-4">
                    {% csrf_token %}
                    <div class="space-y-2">
                        <label class="text-[10px] font-bold text-text-muted uppercase tracking-widest ml-1">Expiration
                            Period</label>
                        <select name="expiry"
                            class="w-full bg-background-dark border border-surface-border text-white rounded-lg px-4 py-3 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all">
                            <option value="30m">30 Minutes</option>
                            <option value="1h" selected>1 Hour</option>
                            <option value="24h">24 Hours</option>
                            <option value="7d">7 Days</option>
                        </select>
                    </div>
                    <button
                        class="mt-4 w-full bg-primary hover:bg-primary-hover text-white font-bold h-12 rounded-lg shadow-neon transition-all flex items-center justify-center gap-2"
                        type="submit">
                        <span class="material-symbols-outlined">add_link</span>
                        <span>Initialize Uplink</span>
                    </button>
                </form>
            </div>

            
            <div class="border border-red-900/50 bg-red-900/5 rounded-xl p-6">
                <h3 class="text-lg font-bold text-white mb-2">Danger Zone</h3>
                <p class="text-text-muted text-xs mb-6">Purging this vector will permanently erase it from all nodes and
                    terminate active links.</p>
                <form action="{% url 'delete_file' file.id %}" method="POST"
                    onsubmit="return confirm('EXTERMINATE THIS DATA? This action cannot be undone.');">
                    {% csrf_token %}
                    <button type="submit"
                        class="w-full border border-red-500/50 text-red-500 hover:bg-red-500 hover:text-white font-bold py-2.5 rounded-lg transition-all flex items-center justify-center gap-2 text-sm uppercase tracking-widest">
                        <span class="material-symbols-outlined">delete_forever</span>
                        <span>Purge Data</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}